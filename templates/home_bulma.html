{% extends "base.html" %}

{% block title %}TIC Nexus - Technical Information Center{% endblock %}

{% block content %}
<div class="hero-gradient" style="min-height: 100vh;">
    <!-- Navbar -->
    {% include 'navbar_public.html' %}

    <!-- Hero Section -->
    <section class="hero is-medium" style="margin-top: 52px;">
        <div class="hero-body">
            <div class="container">
                <div class="columns is-centered">
                    <div class="column is-10 has-text-centered">
                        <h1 class="title is-1 has-text-weight-bold mb-5 animate__animated animate__fadeInDown" style="color: #052c52; font-size: 3.5rem;">
                            Technical Information Center
                        </h1>
                        <p class="subtitle is-4 has-text-grey mb-4 animate__animated animate__fadeInUp animate__delay-1s">
                            Your gateway to technical knowledge and resources
                        </p>
                        <p class="subtitle is-5 has-text-grey-light animate__animated animate__fadeInUp animate__delay-2s">
                            Search through our extensive collection of books, manuals, and technical documents
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Search Section -->
    <section class="section">
        <div class="container">
            <div class="columns is-centered">
                <div class="column is-10" x-data="searchBooks()">
                    <div class="box has-shadow-large animate__animated animate__fadeInUp" style="border-radius: 16px;">
                        <!-- Search Input -->
                        <div class="field is-grouped">
                            <div class="control is-expanded has-icons-left">
                                <input 
                                    x-model="searchQuery"
                                    @keyup.enter="performSearch"
                                    class="input is-large" 
                                    type="text" 
                                    placeholder="Search by title, author, ISBN, or accession number..."
                                >
                                <span class="icon is-left is-large">
                                    <i class="fas fa-search"></i>
                                </span>
                            </div>
                            <div class="control">
                                <button 
                                    @click="performSearch"
                                    :class="{ 'is-loading': loading }"
                                    class="button is-large has-gradient-emerald has-text-weight-bold"
                                >
                                    <span class="icon">
                                        <i class="fas fa-search"></i>
                                    </span>
                                    <span>Search</span>
                                </button>
                            </div>
                        </div>

                        <!-- Search Results -->
                        <div x-show="searchResults.length > 0 || showNoResults" class="mt-5">
                            <div x-show="showNoResults && searchResults.length === 0">
                                <article class="message is-info">
                                    <div class="message-body">
                                        <span class="icon">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                        No books found matching your search.
                                    </div>
                                </article>
                            </div>
                            
                            <div x-show="searchResults.length > 0" style="max-height: 500px; overflow-y: auto; padding: 0.5rem;">
                                <template x-for="book in searchResults" :key="book.id">
                                    <div class="box mb-3 animate__animated animate__fadeIn has-hover-lift" style="overflow: hidden;">
                                        <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                            <!-- Title and Author -->
                                            <div>
                                                <h4 class="title is-5 mb-2" style="color: #052c52; word-break: break-word; line-height: 1.4; margin-bottom: 0.5rem !important;" x-text="book.title"></h4>
                                                <p class="subtitle is-6 has-text-grey" style="word-break: break-word; line-height: 1.5; margin-top: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                                                    <span class="icon" style="margin: 0;">
                                                        <i class="fas fa-user"></i>
                                                    </span>
                                                    <span x-text="book.author"></span>
                                                </p>
                                            </div>
                                            
                                            <!-- Tags and Status -->
                                            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem;">
                                                <div class="tags mb-0" style="flex-wrap: wrap;">
                                                    <span class="tag is-light">
                                                        <span class="icon is-small">
                                                            <i class="fas fa-tag"></i>
                                                        </span>
                                                        <span x-text="book.acc_no"></span>
                                                    </span>
                                                    <span x-show="book.subject" class="tag is-light" :title="book.subject">
                                                        <span class="icon is-small">
                                                            <i class="fas fa-book"></i>
                                                        </span>
                                                        <span x-text="book.subject.length > 20 ? book.subject.substring(0, 20) + '...' : book.subject"></span>
                                                    </span>
                                                    <span x-show="book.isbn" class="tag is-light">
                                                        <span class="icon is-small">
                                                            <i class="fas fa-barcode"></i>
                                                        </span>
                                                        <span x-text="book.isbn"></span>
                                                    </span>
                                                    <span x-show="book.language" class="tag is-info is-light">
                                                        <span class="icon is-small">
                                                            <i class="fas fa-language"></i>
                                                        </span>
                                                        <span x-text="book.language"></span>
                                                    </span>
                                                </div>
                                                <div style="flex-shrink: 0; display: flex; align-items: center; gap: 0.75rem;">
                                                    <a x-show="book.digital_book_id" 
                                                       :href="book.digital_book_format === 'pdf' ? '/public/digital-library/view/' + book.digital_book_id : '/api/digital-library/' + book.digital_book_id + '/download'" 
                                                       class="tag is-info is-medium has-text-weight-bold"
                                                       style="text-decoration: none; cursor: pointer; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white;">
                                                        <span class="icon">
                                                            <i class="fas fa-book-open"></i>
                                                        </span>
                                                        <span x-text="book.digital_book_format === 'pdf' ? 'Read Online' : 'Download Digital'"></span>
                                                    </a>
                                                    
                                                    <span x-show="book.is_issued" class="tag is-danger is-medium">
                                                        <span class="icon">
                                                            <i class="fas fa-times-circle"></i>
                                                        </span>
                                                        <span>Issued</span>
                                                    </span>
                                                    <span x-show="!book.is_issued" class="tag is-success is-medium">
                                                        <span class="icon">
                                                            <i class="fas fa-check-circle"></i>
                                                        </span>
                                                        <span>Available</span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Statistics -->
                        <div class="mt-6 pt-5" style="border-top: 1px solid #e5e7eb;">
                            <div class="columns is-multiline has-text-centered">
                                <div class="column is-3" x-data="{ count: 0 }" x-init="fetch('/api/public/stats').then(r => r.json()).then(d => count = d.total_books)">
                                    <p class="title is-2 has-text-success" x-text="count">0</p>
                                    <p class="subtitle is-6 has-text-grey">Total Books</p>
                                </div>
                                <div class="column is-3" x-data="{ count: 0 }" x-init="fetch('/api/public/stats').then(r => r.json()).then(d => count = d.available_books)">
                                    <p class="title is-2" style="color: #052c52;" x-text="count">0</p>
                                    <p class="subtitle is-6 has-text-grey">Available</p>
                                </div>
                                <div class="column is-3" x-data="{ count: 0 }" x-init="fetch('/api/public/stats').then(r => r.json()).then(d => count = d.digital_library_count)">
                                    <p class="title is-2 has-text-purple" x-text="count">0</p>
                                    <p class="subtitle is-6 has-text-grey">Digital Library</p>
                                </div>
                                <div class="column is-3" x-data="{ count: 0 }" x-init="fetch('/api/public/stats').then(r => r.json()).then(d => count = d.subjects_count)">
                                    <p class="title is-2 has-text-info" x-text="count">0</p>
                                    <p class="subtitle is-6 has-text-grey">Subjects</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="section has-background-white">
        <div class="container">
            <div class="has-text-centered mb-6">
                <h2 class="title is-2 has-text-weight-bold mb-3" style="color: #052c52;">Powerful Features</h2>
                <p class="subtitle is-4 has-text-grey">Everything you need to manage your technical library</p>
            </div>

            <div class="columns is-multiline">
                <!-- Feature 1 -->
                <div class="column is-4">
                    <div class="box has-shadow has-hover-lift animate__animated animate__fadeInUp" style="height: 100%; border-radius: 12px;">
                        <div class="has-text-centered">
                            <div class="has-gradient-emerald is-inline-flex is-align-items-center is-justify-content-center mb-4" 
                                 style="width: 80px; height: 80px; border-radius: 50%;">
                                <span class="icon is-large has-text-white">
                                    <i class="fas fa-search fa-2x"></i>
                                </span>
                            </div>
                            <h4 class="title is-4 mb-3" style="color: #052c52;">Smart Search</h4>
                            <p class="has-text-grey">
                                Instantly find books by title, author, ISBN, or accession number with our powerful search engine.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Feature 2 -->
                <div class="column is-4">
                    <div class="box has-shadow has-hover-lift animate__animated animate__fadeInUp animate__delay-1s" style="height: 100%; border-radius: 12px;">
                        <div class="has-text-centered">
                            <div class="has-gradient-navy is-inline-flex is-align-items-center is-justify-content-center mb-4" 
                                 style="width: 80px; height: 80px; border-radius: 50%;">
                                <span class="icon is-large has-text-white">
                                    <i class="fas fa-book-open fa-2x"></i>
                                </span>
                            </div>
                            <h4 class="title is-4 mb-3" style="color: #052c52;">Digital Library</h4>
                            <p class="has-text-grey">
                                Access digital versions of technical documents and manuals anytime, anywhere.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Feature 3 -->
                <div class="column is-4">
                    <div class="box has-shadow has-hover-lift animate__animated animate__fadeInUp animate__delay-2s" style="height: 100%; border-radius: 12px;">
                        <div class="has-text-centered">
                            <div class="is-inline-flex is-align-items-center is-justify-content-center mb-4" 
                                 style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                                <span class="icon is-large has-text-white">
                                    <i class="fas fa-newspaper fa-2x"></i>
                                </span>
                            </div>
                            <h4 class="title is-4 mb-3" style="color: #052c52;">Magazines</h4>
                            <p class="has-text-grey">
                                Latest Technical Journals, Periodicals and Industry Magazines.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Magazine Carousel Section -->
    <section class="section has-background-light" x-data="magazineCarousel()" x-init="init()">
        <div class="container">
            <div class="has-text-centered mb-6">
                <h2 class="title is-2 has-text-weight-bold mb-4" style="color: #052c52;">Magazines & Periodicals</h2>
                <p class="subtitle is-5 has-text-grey mt-2">Latest technical journals and magazines available for in-library reading</p>
            </div>

            <style>
                .magazine-carousel-wrapper {
                    overflow: hidden;
                    position: relative;
                    padding: 40px 0;
                    mask-image: linear-gradient(to right, transparent, black 15%, black 85%, transparent);
                }
                .magazine-track {
                    display: flex;
                    width: max-content;
                    animation: scroll-magazines 60s linear infinite;
                }
                .magazine-track:hover {
                    animation-play-state: paused;
                }
                @keyframes scroll-magazines {
                    0% { transform: translateX(0); }
                    100% { transform: translateX(-50%); }
                }
                .magazine-item {
                    width: 210px;
                    height: 295px;
                    margin: 0 20px;
                    flex-shrink: 0;
                    background: #fff;
                    border-radius: 12px;
                    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
                    overflow: hidden;
                    position: relative;
                    transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                    cursor: pointer;
                }
                .magazine-item:hover {
                    transform: scale(1.05) translateY(-10px);
                    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
                }
                .magazine-item img {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                    border-radius: 12px;
                }
                .magazine-info-overlay {
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    right: 0;
                    padding: 15px;
                    background: linear-gradient(transparent, rgba(5, 44, 82, 0.9));
                    color: white;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                }
                .magazine-item:hover .magazine-info-overlay {
                    opacity: 1;
                }
            </style>

            <div x-show="magazines.length > 0" class="magazine-carousel-wrapper">
                <div class="magazine-track">
                    <!-- Original List -->
                    <template x-for="(mag, index) in magazines" :key="'orig-' + index">
                        <div class="magazine-item">
                            <img :src="mag.cover_image || 'https://via.placeholder.com/210x295?text=No+Cover'" :alt="mag.title">
                            <div class="magazine-info-overlay">
                                <p class="has-text-weight-bold is-size-6" x-text="mag.title"></p>
                                <p class="is-size-7" x-text="mag.language"></p>
                            </div>
                        </div>
                    </template>
                    <!-- Duplicate List for Seamless Loop -->
                    <template x-for="(mag, index) in magazines" :key="'dup-' + index">
                        <div class="magazine-item">
                            <img :src="mag.cover_image || 'https://via.placeholder.com/210x295?text=No+Cover'" :alt="mag.title">
                            <div class="magazine-info-overlay">
                                <p class="has-text-weight-bold is-size-6" x-text="mag.title"></p>
                                <p class="is-size-7" x-text="mag.language"></p>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <div x-show="magazines.length === 0" class="has-text-centered py-6">
                <p class="has-text-grey is-size-5">New magazines arriving soon!</p>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="section">
        <div class="container">
            <div class="columns is-centered">
                <div class="column is-8 has-text-centered">
                    <h2 class="title is-2 has-text-weight-bold mb-5" style="color: #052c52;">About TIC Nexus</h2>
                    <div class="content is-medium has-text-grey mb-5" style="line-height: 1.8;">
                        <p>
                            The Technical Information Center (TIC) Nexus is a comprehensive library management system designed specifically for 
                            Bharat Electronics Limited. Our platform provides seamless access to technical documentation, research materials, 
                            and engineering resources to support innovation and knowledge sharing.
                        </p>
                    </div>
                    <div class="box has-shadow-large" style="border-radius: 16px;">
                        <p class="has-text-grey mb-4">
                            <span class="icon has-text-success">
                                <i class="fas fa-info-circle"></i>
                            </span>
                            <strong>Need access?</strong> Login with your credentials to access the full system.
                        </p>
                        <a href="/login" class="button is-large has-gradient-emerald has-text-weight-bold">
                            <span class="icon">
                                <i class="fas fa-rocket"></i>
                            </span>
                            <span>Get Started</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer has-background-dark has-text-white">
        <div class="content has-text-centered">
            <h4 class="title is-4 has-text-white mb-2">TIC Nexus</h4>
            <p class="has-text-grey-light mb-4">Bharat Electronics Limited - Technical Information Center</p>
            <p class="is-size-7 has-text-grey-light mb-2">
                &copy; 2026 BEL. All rights reserved.
            </p>
            <p class="is-size-7 has-text-grey">
                Developed by <span class="has-text-success has-text-weight-semibold">Vishal Raj V</span> (E218023)
            </p>
        </div>
    </footer>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function searchBooks() {
        return {
            searchQuery: '',
            searchResults: [],
            showNoResults: false,
            loading: false,

            async performSearch() {
                if (!this.searchQuery.trim()) {
                    this.searchResults = [];
                    this.showNoResults = false;
                    return;
                }

                this.loading = true;
                this.showNoResults = false;

                try {
                    const response = await fetch(`/api/public/search?q=${encodeURIComponent(this.searchQuery)}`);
                    const data = await response.json();
                    
                    this.searchResults = data;
                    this.showNoResults = data.length === 0;
                } catch (error) {
                    console.error('Search error:', error);
                    this.searchResults = [];
                    this.showNoResults = true;
                } finally {
                    this.loading = false;
                }
            }
        }
    }

    function magazineCarousel() {
        return {
            magazines: [],
            async init() {
                try {
                    const response = await fetch('/api/public/magazines');
                    if (response.ok) {
                        this.magazines = await response.json();
                        // Filter to only show magazines with cover images for the carousel
                        this.magazines = this.magazines.filter(m => m.cover_image);
                    }
                } catch (error) {
                    console.error('Error fetching magazines:', error);
                }
            }
        }
    }
</script>
{% endblock %}
