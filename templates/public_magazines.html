{% extends "base.html" %}

{% block title %}TIC Nexus - Magazines & Periodicals{% endblock %}

{% block content %}
<div class="hero-gradient" style="min-height: 100vh;">
    <!-- Navbar -->
    {% include 'navbar_public.html' %}

    <section class="section" style="margin-top: 60px;">
        <div class="container">
            <div class="has-text-centered mb-6">
                <h1 class="title is-2" style="color: #052c52;">Magazines & Periodicals</h1>
                <p class="subtitle is-5 has-text-grey">Collection of technical journals and periodicals for in-library reading only.</p>
                <div class="notification is-info is-light is-inline-block py-2 px-4" style="border-radius: 50px;">
                    <span class="icon"><i class="fas fa-info-circle"></i></span>
                    <span>Note: Magazines are not available for physical circulation or issue.</span>
                </div>
            </div>

            <div x-data="publicMagazines()" x-init="init()" class="columns is-multiline">
                <template x-for="mag in magazines" :key="mag.id">
                    <div class="column is-3">
                        <div class="box p-0 magazine-public-card has-hover-lift animate__animated animate__fadeIn">
                            <figure class="image magazine-card-image-container">
                                <img :src="mag.cover_image || 'https://via.placeholder.com/210x295?text=No+Cover'" :alt="mag.title">
                                <div class="magazine-reading-only-badge">
                                    <span class="tag is-dark is-rounded">
                                        <span class="icon is-small"><i class="fas fa-eye"></i></span>
                                        <span>Reading Only</span>
                                    </span>
                                </div>
                            </figure>
                            <div class="p-4">
                                <h3 class="title is-5 mb-2" x-text="mag.title"></h3>
                                <div class="tags mb-3">
                                    <span class="tag is-info is-light" x-text="mag.language"></span>
                                    <span x-show="mag.category" class="tag is-light" x-text="mag.category"></span>
                                </div>
                                
                                <div class="recent-issues mt-3">
                                    <p class="is-size-7 has-text-weight-bold has-text-grey mb-2 uppercase">Latest Received Issues:</p>
                                    <ul class="is-size-7">
                                        <template x-for="issue in mag.recent_issues" :key="issue.id">
                                            <li class="mb-1 is-flex is-justify-content-between">
                                                <span x-text="issue.issue_description"></span>
                                                <span class="has-text-grey-light" x-text="formatDate(issue.received_date)"></span>
                                            </li>
                                        </template>
                                        <template x-if="mag.recent_issues.length === 0">
                                            <li class="has-text-grey-light italic">No issues logged yet</li>
                                        </template>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>

                <div x-show="magazines.length === 0" class="column is-12 has-text-centered py-6">
                    <p class="is-size-4 has-text-grey-light">No magazines found in the collection.</p>
                </div>
            </div>
        </div>
    </section>

    <style>
        .magazine-public-card {
            height: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border-radius: 12px;
        }
        .magazine-card-image-container {
            height: 350px;
            overflow: hidden;
            position: relative;
        }
        .magazine-card-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .magazine-reading-only-badge {
            position: absolute;
            top: 15px;
            right: 15px;
        }
        .uppercase { text-transform: uppercase; }
        .italic { font-style: italic; }
    </style>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function publicMagazines() {
        return {
            magazines: [],
            async init() {
                try {
                    const response = await fetch('/api/public/magazines');
                    if (response.ok) {
                        this.magazines = await response.json();
                    }
                } catch (error) {
                    console.error('Error fetching magazines:', error);
                }
            },
            formatDate(dateStr) {
                if (!dateStr) return '';
                const date = new Date(dateStr);
                return date.toLocaleDateString('en-IN', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                });
            }
        }
    }
</script>
{% endblock %}
