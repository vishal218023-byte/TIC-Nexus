{% extends "base.html" %}

{% block title %}TIC Nexus - Magazines & Periodicals{% endblock %}

{% block content %}
<div class="hero-gradient" style="min-height: 100vh;">
    <!-- Navbar -->
    {% include 'navbar_public.html' %}

    <section class="section" style="margin-top: 60px;">
        <div class="container">
            <div class="has-text-centered mb-6">
                <h1 class="title is-2" style="color: #052c52;">Magazines & Periodicals</h1>
                <p class="subtitle is-5 has-text-grey">Collection of technical journals and periodicals for in-library reading only.</p>
                <div class="notification is-info is-light is-inline-block py-2 px-4" style="border-radius: 50px;">
                    <span class="icon"><i class="fas fa-info-circle"></i></span>
                    <span>Note: Magazines are not available for physical circulation or issue.</span>
                </div>
            </div>

            <div x-data="publicMagazines()" x-init="init()" class="columns is-multiline">
                <template x-for="mag in magazines" :key="mag.id">
                    <div class="column is-3">
                        <div class="box p-0 magazine-public-card has-hover-lift animate__animated animate__fadeIn">
                            <figure class="image magazine-card-image-container">
                                <template x-if="mag.cover_image">
                                    <img :src="mag.cover_image" :alt="mag.title">
                                </template>
                                <template x-if="!mag.cover_image">
                                    <div class="magazine-placeholder-container" :style="'background-color: ' + getPlaceholderColor(mag.title)">
                                        <span class="magazine-placeholder-letter" x-text="mag.title ? mag.title.charAt(0).toUpperCase() : 'M'"></span>
                                    </div>
                                </template>
                                <div class="magazine-reading-only-badge">
                                    <span class="tag is-dark is-rounded">
                                        <span class="icon is-small"><i class="fas fa-eye"></i></span>
                                        <span>Reading Only</span>
                                    </span>
                                </div>
                            </figure>
                            <div class="p-4">
                                <h3 class="title is-5 mb-2" x-text="mag.title"></h3>
                                <div class="is-size-7 has-text-grey mb-3">
                                    <div x-show="mag.language" class="mb-1">
                                        <span class="icon is-small"><i class="fas fa-language"></i></span> <span x-text="mag.language"></span>
                                    </div>
                                    <div x-show="mag.category" class="mb-1">
                                        <span class="icon is-small"><i class="fas fa-tag"></i></span> <span x-text="mag.category"></span>
                                    </div>
                                    <div x-show="mag.frequency">
                                        <span class="icon is-small"><i class="fas fa-clock"></i></span> <span x-text="mag.frequency"></span>
                                    </div>
                                </div>
                                
                                <div class="recent-issues mt-3">
                                    <p class="is-size-7 has-text-weight-bold has-text-grey mb-2 uppercase">Latest Received Issues:</p>
                                    <ul class="is-size-7">
                                        <template x-for="issue in mag.recent_issues" :key="issue.id">
                                            <li class="mb-1 is-flex is-justify-content-between">
                                                <span x-text="issue.issue_description"></span>
                                                <span class="has-text-grey-light" x-text="formatDate(issue.received_date)"></span>
                                            </li>
                                        </template>
                                        <template x-if="mag.recent_issues.length === 0">
                                            <li class="has-text-grey-light italic">No issues logged yet</li>
                                        </template>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>

                <div x-show="magazines.length === 0" class="column is-12 has-text-centered py-6">
                    <p class="is-size-4 has-text-grey-light">No magazines found in the collection.</p>
                </div>
            </div>
        </div>
    </section>

    <style>
        .magazine-public-card {
            height: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border-radius: 12px;
        }
        .magazine-card-image-container {
            aspect-ratio: 3/4;
            overflow: hidden;
            position: relative;
            background-color: #f5f5f5;
        }
        .magazine-card-image-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .magazine-placeholder-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f0f0f0;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        .magazine-placeholder-letter {
            font-size: 5rem;
            opacity: 0.95;
            letter-spacing: -2px;
        }
        .magazine-reading-only-badge {
            position: absolute;
            top: 15px;
            right: 15px;
        }
        .uppercase { text-transform: uppercase; }
        .italic { font-style: italic; }
    </style>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function publicMagazines() {
        return {
            magazines: [],
            async init() {
                try {
                    const response = await fetch('/api/public/magazines');
                    if (response.ok) {
                        this.magazines = await response.json();
                    }
                } catch (error) {
                    console.error('Error fetching magazines:', error);
                }
            },
            getPlaceholderColor(title) {
                if (!title) return '#3273dc';
                const colors = [
                    '#4a90e2', '#3273dc', '#23d160', '#ffdd57', '#ff3860',
                    '#7957d5', '#00d1b2', '#00947e', '#485fc7', '#b86bff',
                    '#3e8ed0', '#00d1b2', '#00b89c', '#485fc7', '#363636'
                ];
                let hash = 0;
                for (let i = 0; i < title.length; i++) {
                    hash = title.charCodeAt(i) + ((hash << 5) - hash);
                }
                const color = colors[Math.abs(hash) % colors.length];
                return color;
            },
            formatDate(dateStr) {
                if (!dateStr) return '';
                const date = new Date(dateStr);
                return date.toLocaleDateString('en-IN', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                });
            }
        }
    }
</script>
{% endblock %}
